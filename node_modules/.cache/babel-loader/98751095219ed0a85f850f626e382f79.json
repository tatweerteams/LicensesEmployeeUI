{"ast":null,"code":"import _objectSpread from \"D:/repo Tatweer/tatweerteams/CheckbooksOrderingUI/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";\nimport \"core-js/modules/es.object.to-string.js\";\nimport \"core-js/modules/web.dom-collections.for-each.js\";\nimport \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/es.json.stringify.js\";\nimport { routes } from \"../../../router\";\nimport { login as _login, getInfoUser } from \"../api\";\nimport { getToken, setToken, removeToken, setUserInfo, getUserInfo } from \"../../../util/session\";\nimport { createHelpers } from \"vuex-map-fields\";\nvar _createHelpers = createHelpers({\n    getterType: \"getDataFields\",\n    mutationType: \"updateDataField\"\n  }),\n  getDataFields = _createHelpers.getDataFields,\n  updateDataField = _createHelpers.updateDataField;\n\n// function hasPermission(group, route) {\n//   var result = this.userRoles.some((item) => meta.includes(item));\n\n//   // if (route.meta) {\n\n//   //   return route.meta.some((g) => g == group);\n//   // } else {\n//   //   return true;\n//   // }\n// }\n\nexport function filterAsyncRoutes(authBaseRoutes, userPermisstions) {\n  var res = [];\n  console.log(userPermisstions);\n  authBaseRoutes.forEach(function (predRoute) {\n    var route = _objectSpread({}, predRoute);\n    if (!route.hidden) {\n      console.log(route);\n      res.push(route);\n    }\n  });\n  return res;\n\n  // authBaseRoutes.forEach((route) => {\n  //   const tmp = { ...route };\n\n  //   if (hasPermission(group, tmp)) {\n  //     if (tmp.children) {\n  //       tmp.children = filterAsyncRoutes(tmp.children, group);\n  //     }\n  //     res.push(tmp);\n  //   }\n  // });\n  // return res;\n}\n\nexport default {\n  namespaced: true,\n  state: {\n    routes: [],\n    tokenId: getToken(),\n    roles: [],\n    group: [],\n    userInfo: {}\n  },\n  getters: {\n    getDataFields: getDataFields,\n    isAuthenticated: function isAuthenticated(state) {\n      return state.tokenId !== null;\n    },\n    getToken: function getToken(state) {\n      return state.tokenId;\n    },\n    getRole: function getRole(state) {\n      var _state$roles;\n      return (_state$roles = state.roles) !== null && _state$roles !== void 0 ? _state$roles : [];\n    }\n  },\n  mutations: {\n    updateDataField: updateDataField,\n    SET_TOKEN: function SET_TOKEN(state, token) {\n      state.tokenId = token;\n    },\n    SET_ROLES: function SET_ROLES(state, roles) {\n      state.roles = roles;\n    },\n    SET_USER_INFO: function SET_USER_INFO(state, userinfo) {\n      state.userInfo = userinfo;\n    },\n    SET_ROUTES: function SET_ROUTES(state) {\n      var routerBeforFilter = JSON.parse(JSON.stringify(routes));\n      var rrrr = filterAsyncRoutes(routerBeforFilter, state.roles);\n      console.log(rrrr);\n      state.routes = rrrr;\n\n      // state.routes = JSON.parse(JSON.stringify(routes));\n\n      // console.log(\"state.roles\", state.roles);\n      // console.log(state.routes);\n    },\n    clearAuthData: function clearAuthData(state) {\n      state.tokenId = null;\n      state.routes = [];\n      state.userInfo = {};\n    }\n  },\n  actions: {\n    login: function login(_ref, authData) {\n      var commit = _ref.commit;\n      var nameOrNumber = authData.nameOrNumber,\n        password = authData.password;\n      return new Promise(function (resolve, reject) {\n        _login({\n          nameOrNumber: nameOrNumber,\n          password: password\n        }).then(function (response) {\n          commit(\"SET_TOKEN\", response.result.accessToken);\n          commit(\"SET_ROLES\", response.result.permisstions);\n          commit(\"SET_USER_INFO\", response.result);\n          setToken(response.result.accessToken);\n          setUserInfo(response.result);\n          resolve();\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    getUserInfoSesstion: function getUserInfoSesstion(_ref2) {\n      var commit = _ref2.commit;\n      getUserInfo().then(function (response) {\n        commit(\"SET_USER_INFO\", response);\n        commit(\"SET_ROLES\", response === null || response === void 0 ? void 0 : response.permisstions);\n        commit(\"SET_ROUTES\");\n      });\n    },\n    getInfo: function getInfo(_ref3) {\n      var commit = _ref3.commit;\n      return new Promise(function (resolve, reject) {\n        getInfoUser().then(function (response) {\n          var result = response.result;\n          if (!result) {\n            reject(\"الرجاء إعادة تسجيل الدخول من جديد\");\n          }\n          var permisstions = result.permisstions;\n          if (!permisstions || permisstions.length <= 0) {\n            reject(\"لايوجد صلاحية للمستخدم الرجاء إعادة التسجيل الدخول\");\n          }\n          commit(\"SET_ROLES\", permisstions);\n          commit(\"SET_USER_INFO\", result);\n          resolve(result);\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    logout: function logout(_ref4) {\n      var commit = _ref4.commit;\n      commit(\"clearAuthData\");\n      removeToken();\n    },\n    tryAutoLogin: function tryAutoLogin(_ref5) {\n      var commit = _ref5.commit;\n      var token = getToken();\n      if (!token) {\n        return Promise.reject(\"no token\");\n      }\n      commit(\"SET_TOKEN\", {\n        token: token\n      });\n      return Promise.resolve(true);\n    }\n  }\n};","map":{"version":3,"names":["routes","login","getInfoUser","getToken","setToken","removeToken","setUserInfo","getUserInfo","createHelpers","getterType","mutationType","getDataFields","updateDataField","filterAsyncRoutes","authBaseRoutes","userPermisstions","res","console","log","forEach","predRoute","route","hidden","push","namespaced","state","tokenId","roles","group","userInfo","getters","isAuthenticated","getRole","mutations","SET_TOKEN","token","SET_ROLES","SET_USER_INFO","userinfo","SET_ROUTES","routerBeforFilter","JSON","parse","stringify","rrrr","clearAuthData","actions","authData","commit","nameOrNumber","password","Promise","resolve","reject","then","response","result","accessToken","permisstions","catch","error","getUserInfoSesstion","getInfo","length","logout","tryAutoLogin"],"sources":["D:/repo Tatweer/tatweerteams/CheckbooksOrderingUI/src/views/login/store/index.js"],"sourcesContent":["import { routes } from \"../../../router\";\r\n\r\nimport { login, getInfoUser } from \"../api\";\r\nimport {\r\n  getToken,\r\n  setToken,\r\n  removeToken,\r\n  setUserInfo,\r\n  getUserInfo,\r\n} from \"../../../util/session\";\r\n\r\nimport { createHelpers } from \"vuex-map-fields\";\r\nconst { getDataFields, updateDataField } = createHelpers({\r\n  getterType: \"getDataFields\",\r\n  mutationType: \"updateDataField\",\r\n});\r\n\r\n// function hasPermission(group, route) {\r\n//   var result = this.userRoles.some((item) => meta.includes(item));\r\n\r\n//   // if (route.meta) {\r\n\r\n//   //   return route.meta.some((g) => g == group);\r\n//   // } else {\r\n//   //   return true;\r\n//   // }\r\n// }\r\n\r\nexport function filterAsyncRoutes(authBaseRoutes, userPermisstions) {\r\n  const res = [];\r\n  console.log(userPermisstions);\r\n  authBaseRoutes.forEach((predRoute) => {\r\n    const route = { ...predRoute };\r\n    if(!route.hidden)\r\n    {\r\n      console.log(route)\r\n      res.push(route);\r\n    }\r\n   \r\n  });\r\n  return res;\r\n\r\n  // authBaseRoutes.forEach((route) => {\r\n  //   const tmp = { ...route };\r\n\r\n  //   if (hasPermission(group, tmp)) {\r\n  //     if (tmp.children) {\r\n  //       tmp.children = filterAsyncRoutes(tmp.children, group);\r\n  //     }\r\n  //     res.push(tmp);\r\n  //   }\r\n  // });\r\n  // return res;\r\n}\r\n\r\nexport default {\r\n  namespaced: true,\r\n  state: {\r\n    routes: [],\r\n    tokenId: getToken(),\r\n    roles: [],\r\n    group: [],\r\n    userInfo: {},\r\n  },\r\n\r\n  getters: {\r\n    getDataFields,\r\n    isAuthenticated(state) {\r\n      return state.tokenId !== null;\r\n    },\r\n    getToken(state) {\r\n      return state.tokenId;\r\n    },\r\n\r\n    getRole(state) {\r\n      return state.roles ?? [];\r\n    },\r\n  },\r\n\r\n  mutations: {\r\n    updateDataField,\r\n    SET_TOKEN: (state, token) => {\r\n      state.tokenId = token;\r\n    },\r\n    SET_ROLES: (state, roles) => {\r\n      state.roles = roles;\r\n    },\r\n\r\n    SET_USER_INFO(state, userinfo) {\r\n      state.userInfo = userinfo;\r\n    },\r\n\r\n    SET_ROUTES(state) {\r\n      let routerBeforFilter = JSON.parse(JSON.stringify(routes));\r\n\r\n      var rrrr = filterAsyncRoutes(routerBeforFilter, state.roles);\r\n      console.log(rrrr);\r\n\r\n      state.routes = rrrr;\r\n\r\n      // state.routes = JSON.parse(JSON.stringify(routes));\r\n\r\n      // console.log(\"state.roles\", state.roles);\r\n      // console.log(state.routes);\r\n    },\r\n    clearAuthData(state) {\r\n      state.tokenId = null;\r\n      state.routes = [];\r\n      state.userInfo = {};\r\n    },\r\n  },\r\n\r\n  actions: {\r\n    login({ commit }, authData) {\r\n      const { nameOrNumber, password } = authData;\r\n      return new Promise((resolve, reject) => {\r\n        login({ nameOrNumber: nameOrNumber, password: password })\r\n          .then((response) => {\r\n            commit(\"SET_TOKEN\", response.result.accessToken);\r\n            commit(\"SET_ROLES\", response.result.permisstions);\r\n            commit(\"SET_USER_INFO\", response.result);\r\n            setToken(response.result.accessToken);\r\n            setUserInfo(response.result);\r\n            resolve();\r\n          })\r\n          .catch((error) => {\r\n            reject(error);\r\n          });\r\n      });\r\n    },\r\n\r\n    getUserInfoSesstion({ commit }) {\r\n      getUserInfo().then((response) => {\r\n        commit(\"SET_USER_INFO\", response);\r\n        commit(\"SET_ROLES\", response?.permisstions);\r\n        commit(\"SET_ROUTES\");\r\n      });\r\n    },\r\n    getInfo({ commit }) {\r\n      return new Promise((resolve, reject) => {\r\n        getInfoUser()\r\n          .then((response) => {\r\n            const { result } = response;\r\n\r\n            if (!result) {\r\n              reject(\"الرجاء إعادة تسجيل الدخول من جديد\");\r\n            }\r\n\r\n            const { permisstions } = result;\r\n\r\n            if (!permisstions || permisstions.length <= 0) {\r\n              reject(\"لايوجد صلاحية للمستخدم الرجاء إعادة التسجيل الدخول\");\r\n            }\r\n\r\n            commit(\"SET_ROLES\", permisstions);\r\n            commit(\"SET_USER_INFO\", result);\r\n\r\n            resolve(result);\r\n          })\r\n          .catch((error) => {\r\n            reject(error);\r\n          });\r\n      });\r\n    },\r\n\r\n    logout({ commit }) {\r\n      commit(\"clearAuthData\");\r\n      removeToken();\r\n    },\r\n\r\n    tryAutoLogin({ commit }) {\r\n      const token = getToken();\r\n      if (!token) {\r\n        return Promise.reject(\"no token\");\r\n      }\r\n      commit(\"SET_TOKEN\", {\r\n        token: token,\r\n      });\r\n      return Promise.resolve(true);\r\n    },\r\n  },\r\n};\r\n"],"mappings":"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"},"metadata":{},"sourceType":"module"}